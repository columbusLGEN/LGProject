//
//  UFriendDynamicTableViewCell.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 17/9/1.
//  Copyright © 2017年 lee. All rights reserved.
//

#import "UFriendDynamicTableViewCell.h"

#import "ZStarView.h"

@interface UFriendDynamicTableViewCell ()

@property (weak, nonatomic) IBOutlet UIImageView *imgAvatar;  // 头像
@property (weak, nonatomic) IBOutlet UILabel *lblUserName;    // 用户名
@property (weak, nonatomic) IBOutlet UILabel *lblDesc;        // 分享说明
@property (weak, nonatomic) IBOutlet UILabel *lblTime;        // 分享时间

@property (weak, nonatomic) IBOutlet UIImageView *imgBookCover; // 图书封面
@property (weak, nonatomic) IBOutlet UIView *viewBackground;  // 图书背景
@property (weak, nonatomic) IBOutlet UILabel *lblBookName;    // 图书名
@property (weak, nonatomic) IBOutlet UILabel *lblAuthor;      // 作者
@property (weak, nonatomic) IBOutlet UIView *starView;        // 评星
@property (weak, nonatomic) IBOutlet UILabel *lblMoney;       // 价格
@property (weak, nonatomic) IBOutlet UIView *viewShadow;
@property (weak, nonatomic) IBOutlet UIView *viewBottom;

@property (strong, nonatomic) ZStarView *star; // 评分
@property (strong, nonatomic) DynamicModel *dynamic;

@end

@implementation UFriendDynamicTableViewCell

- (void)awakeFromNib {
    [super awakeFromNib];
    // Initialization code
    [self configDynamicCell];
}

- (void)setSelected:(BOOL)selected animated:(BOOL)animated {
    [super setSelected:selected animated:animated];
}

- (void)configDynamicCell
{
    _imgAvatar.layer.cornerRadius = _imgAvatar.height/2;
    
    _imgAvatar.layer.borderWidth = 3.f;
    _imgAvatar.layer.borderColor = [UIColor whiteColor].CGColor;
    
    _viewShadow.layer.shadowOffset  = CGSizeMake(0, 0);
    _viewShadow.layer.shadowOpacity = 0.1;
    _viewShadow.layer.shadowRadius  = 1;
    _viewShadow.backgroundColor = [UIColor clearColor];
    
    _viewBackground.backgroundColor = [UIColor cm_grayColor__F8F8F8_1];
    _viewBottom.backgroundColor = [UIColor cm_grayColor__F1F1F1_1];
    
    _star = [[ZStarView alloc] initWithFrame:CGRectMake(0, 0, 15*5, 15) numberOfStar:5];
    _star.canChange = NO;
    [_starView addSubview:_star];
    
    UITapGestureRecognizer *tapBook = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(toBookDetailView)];
    [_viewBackground addGestureRecognizer:tapBook];
    
    UITapGestureRecognizer *tapUser = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(toFriendInfoView)];
    [_imgAvatar addGestureRecognizer:tapUser];
    
    [self configViewColor];
    [self configViewFont];
}

- (void)configViewColor
{
    _lblUserName.textColor = [UIColor cm_blackColor_333333_1];
    _lblTime.textColor     = [UIColor cm_blackColor_333333_1];
    _lblDesc.textColor     = [UIColor cm_blackColor_333333_1];
    _lblBookName.textColor = [UIColor cm_blackColor_333333_1];
    _lblAuthor.textColor   = [UIColor cm_blackColor_333333_1];
    _lblMoney.textColor    = [UIColor cm_orangeColor_FF5910_1];
}

- (void)configViewFont
{
    _lblUserName.font = [UIFont systemFontOfSize:cFontSize_16];
    _lblDesc.font     = [UIFont systemFontOfSize:cFontSize_16];
    _lblTime.font     = [UIFont systemFontOfSize:cFontSize_14];
    
    _lblBookName.font = [UIFont systemFontOfSize:cFontSize_16];
    _lblAuthor.font   = [UIFont systemFontOfSize:cFontSize_14];
    _lblMoney.font    = [UIFont systemFontOfSize:cFontSize_12];
}

#pragma mark -

- (void)dataDidChange
{
    _dynamic = self.data;
    
    [_imgAvatar sd_setImageWithURL:[NSURL URLWithString:_dynamic.friendIconUrl] placeholderImage:[UIImage imageNamed:@"img_avatar_placeholder"]];
    _lblUserName.text = _dynamic.friendName.length > 0 ? _dynamic.friendName : LOCALIZATION(@"匿名");
    _lblDesc.text = _dynamic.shareTitle;
    _lblTime.text = _dynamic.createTime;
    
    [_imgBookCover sd_setImageWithURL:[NSURL URLWithString:_dynamic.iconUrl]];
    _lblBookName.text = [UserRequest sharedInstance].language == ENUM_LanguageTypeChinese ? _dynamic.bookName : _dynamic.en_bookName;
    _lblAuthor.text = [NSString stringWithFormat:@"%@: %@", LOCALIZATION(@"作者"),  [UserRequest sharedInstance].language == ENUM_LanguageTypeChinese ? _dynamic.author : _dynamic.en_author];
    
    NSString *price = [NSString stringWithFormat:@"%@%.2f", LOCALIZATION(@"¥"), _dynamic.price];
    NSMutableAttributedString *money = [[NSMutableAttributedString alloc] initWithString:price];
    NSRange upRang = NSMakeRange(1, price.length - 1);
    [money addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:_lblBookName.font.pointSize] range:upRang];
    _lblMoney.attributedText = money;
    
    [_star setScore:_dynamic.score withAnimation:YES completion:^(BOOL finished) {
        // 设置
    }];
}

- (void)toBookDetailView
{
    [self.delegate toBookDetailWithBookId:_dynamic.bookId];
}

- (void)toFriendInfoView
{
    FriendModel *friend = [FriendModel new];
    friend.userId = _dynamic.userId;
    friend.name = _dynamic.friendName.length > 0 ? _dynamic.friendName : LOCALIZATION(@"匿名");
    friend.iconUrl = _dynamic.friendIconUrl;
    [self.delegate toFriendInfoWithFriend:friend];
}

@end
