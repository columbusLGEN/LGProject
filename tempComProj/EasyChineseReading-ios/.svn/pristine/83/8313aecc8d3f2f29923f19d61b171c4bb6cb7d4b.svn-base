//
//  UFriendReadInfoTableViewCell.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 2017/10/12.
//  Copyright © 2017年 retech. All rights reserved.
//

#import "UFriendReadInfoTableViewCell.h"

@interface UFriendReadInfoTableViewCell ()

@property (strong, nonatomic) IBOutlet UIImageView *imgAvatar;  // 头像
@property (strong, nonatomic) IBOutlet UIView *viewBackground;  // 背景

@property (strong, nonatomic) IBOutlet UILabel *lblUserName;    // 用户名
@property (strong, nonatomic) IBOutlet UILabel *lblDesc;        // 分享说明
@property (strong, nonatomic) IBOutlet UILabel *lblTime;        // 分享时间

@property (strong, nonatomic) IBOutlet UILabel *lblDesReaded;   // 描述 读完
@property (strong, nonatomic) IBOutlet UILabel *lblDesReadTime; // 描述 总阅读小时
@property (strong, nonatomic) IBOutlet UILabel *lblDesReadWords;// 描述 阅读字数

@property (strong, nonatomic) IBOutlet UILabel *lblReaded;       // 读完
@property (strong, nonatomic) IBOutlet UILabel *lblReadTime;     // 总阅读小时
@property (strong, nonatomic) IBOutlet UILabel *lblReadWords;    // 阅读字数

@property (weak, nonatomic) IBOutlet UIView *viewLLine;
@property (weak, nonatomic) IBOutlet UIView *viewRLine;

@end

@implementation UFriendReadInfoTableViewCell

- (void)awakeFromNib {
    [super awakeFromNib];
    [self configManager];
}

- (void)setSelected:(BOOL)selected animated:(BOOL)animated {
    [super setSelected:selected animated:animated];

    // Configure the view for the selected state
}

- (void)updateSystemLanguage
{
    _lblDesReaded.text    = LOCALIZATION(@"已完成阅读");
    _lblDesReadTime.text  = LOCALIZATION(@"总阅读小时");
    _lblDesReadWords.text = LOCALIZATION(@"总阅读字数");
}

- (void)configManager
{
    _imgAvatar.layer.cornerRadius = _imgAvatar.height/2;
    
    _imgAvatar.layer.borderWidth = 3.f;
    _imgAvatar.layer.borderColor = [UIColor whiteColor].CGColor;
    
    _imgAvatar.layer.shadowOffset = CGSizeMake(0, 0);
    _imgAvatar.layer.shadowColor = [UIColor blackColor].CGColor;
    _imgAvatar.layer.shadowOpacity = 0.8f;
    _imgAvatar.layer.shadowRadius = 4.f;
    
    _viewBackground.layer.borderColor = [UIColor cm_lineColor_D9D7D7_1].CGColor;
    _viewBackground.layer.borderWidth = 1.f;
    
    _viewLLine.backgroundColor = [UIColor cm_lineColor_D9D7D7_1];
    _viewRLine.backgroundColor = [UIColor cm_lineColor_D9D7D7_1];
    
    [self configViewColor:[UIColor cm_mainColor]];
    [self configViewFont];
}

- (void)configViewColor:(UIColor *)mainColor
{
    _lblReaded.textColor    = mainColor;
    _lblReadTime.textColor  = mainColor;
    _lblReadWords.textColor = mainColor;
    
    _lblUserName.textColor     = [UIColor cm_blackColor_333333_1];
    _lblTime.textColor         = [UIColor cm_blackColor_333333_1];
    _lblDesc.textColor         = [UIColor cm_blackColor_333333_1];
    _lblDesReaded.textColor    = [UIColor cm_blackColor_333333_1];
    _lblDesReadTime.textColor  = [UIColor cm_blackColor_333333_1];
    _lblDesReadWords.textColor = [UIColor cm_blackColor_333333_1];
}

- (void)configViewFont
{
    UIFont *defaultFont  = [UIFont systemFontOfSize:isPad ? cFontSize_18 : cFontSize_16];
    UIFont *describeFont = [UIFont systemFontOfSize:isPad ? 20 : cFontSize_18];
    
    _lblUserName.font = [UIFont systemFontOfSize:isPad ? 22 : 20];
    _lblDesc.font     = defaultFont;
    _lblTime.font     = [UIFont systemFontOfSize:14.f];
    
    _lblReaded.font    = defaultFont;
    _lblReadTime.font  = defaultFont;
    _lblReadWords.font = defaultFont;
    
    _lblDesReaded.font    = describeFont;
    _lblDesReadTime.font  = describeFont;
    _lblDesReadWords.font = describeFont;
}

- (void)dataDidChange
{
    DynamicModel *dynamic = self.data;
    
    [_imgAvatar sd_setImageWithURL:[NSURL URLWithString:dynamic.friendIconUrl] placeholderImage:[UIImage imageNamed:@"img_avatar_placeholder"]];
    _lblUserName.text = dynamic.friendName.length > 0 ? dynamic.friendName : LOCALIZATION(@"匿名");
    _lblTime.text = dynamic.createTime;
    
    NSMutableAttributedString *ranking = [[NSMutableAttributedString alloc] initWithString:[NSString stringWithFormat:@"%@%ld%%%@", LOCALIZATION(@"我战胜了"), dynamic.ranking, LOCALIZATION(@"的书友")]];
    // 获取要调整颜色的文字位置,调整颜色
    NSRange rangePercent = [[ranking string] rangeOfString:@"%"];
    // 更新第一个空格到%之间的范围
    NSRange upRange = NSMakeRange(rangePercent.location - [NSString stringWithFormat:@"%ld", dynamic.ranking].length, [NSString stringWithFormat:@"%ld", dynamic.ranking].length);
    [ranking addAttribute:NSForegroundColorAttributeName value:[UIColor cm_mainColor] range:upRange];
    _lblDesc.attributedText = ranking;
    
    _lblReaded.text    = [NSString stringWithFormat:@"%ld %@", dynamic.readThrough, LOCALIZATION(@"本")];
    _lblReadTime.text  = [NSString stringWithFormat:@"%ld %@", dynamic.readTime, LOCALIZATION(@"小时")];
    _lblReadWords.text = [NSString stringWithFormat:@"%ld %@", dynamic.sameDayWord, LOCALIZATION(@"字")];
}

@end
