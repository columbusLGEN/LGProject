//
//  ECRBookrackCollectionViewCell.m
//  EasyChineseReading-ios
//
//  Created by lee on 2017/9/5.
//  Copyright © 2017年 lee. All rights reserved.
//

#import "ECRBookrackCollectionViewCell.h"
#import "ECRBookrackModel.h"
#import "ECRBookDownloadStateView.h"

@interface ECRBookrackCollectionViewCell ()
@property (weak, nonatomic) IBOutlet UIImageView *icon;
@property (weak, nonatomic) IBOutlet UILabel *bfName;// book or file

@property (weak, nonatomic) IBOutlet UIView *fileCoverView;// 文件夹封面view
@property (weak, nonatomic) IBOutlet UIView *bgBorderView;
@property (weak, nonatomic) IBOutlet UIButton *seBtn;
@property (weak, nonatomic) IBOutlet UIButton *didSelectedBtn;

@end

@implementation ECRBookrackCollectionViewCell

- (void)setModel:(ECRBookrackModel *)model{
    _model = model;
    
    // 下载状态
    self.bdsView.model = model.dsModel;
    NSString *bfText = @"汉语读物";
    
    if (model.books == nil) {// 单本书
        bfText = [NSString stringWithFormat:@"%@\n",model.bookName];
//        bfText = [NSString stringWithFormat:@"%@\n",model.name];
        _fileCoverView.hidden = YES;
        self.icon.hidden = NO;
        [self.icon sd_setImageWithURL:[NSURL URLWithString:model.iconUrl]
                           placeholderImage:LGPlaceHolderImg];
        self.icon.clipsToBounds = YES;
        
        self.seBtn.selected = model.isSelected;
        self.seBtn.hidden = !model.isEditState;
        self.didSelectedBtn.hidden = !model.isEditState;
        self.bdsView.hidden = model.isEditState;
    }else{// 文件夹
        bfText = [NSString stringWithFormat:@"%@\n",model.name];
        self.seBtn.hidden = YES;
        self.didSelectedBtn.hidden = YES;
        [self setFileCover];
    }
    
    _bfName.text = bfText;

}

- (IBAction)editStateDidClick:(UIButton *)sender {
    // 编辑状态下 模型的选中状态切换
    if (self.model.isSelected) {
        self.model.isSelected = NO;
    }else{
        self.model.isSelected = YES;
    }
    if ([self.delegate respondsToSelector:@selector(brCellBookEditDidClick:inx:model:)]) {
        [self.delegate brCellBookEditDidClick:self inx:self.inx model:self.model];
    }
}


- (void)awakeFromNib{
    [super awakeFromNib];
    
    UIColor *borderColor0 = [UIColor colorWithHexString:@"cccccc"];
    UIColor *borderColor1 = [UIColor colorWithHexString:@"e3e3e3"];
    _fileCoverView.layer.borderWidth = 1;
    _fileCoverView.layer.borderColor = borderColor0.CGColor;
    _bgBorderView.layer.borderWidth = 1;
    _bgBorderView.layer.borderColor = borderColor1.CGColor;
    
    self.icon.clipsToBounds = YES;
    self.icon.contentMode = UIViewContentModeScaleAspectFill;
    self.clipsToBounds = NO;
    
    self.seBtn.selected = YES;
}

- (void)setFileCover{
    _fileCoverView.hidden = NO;
    self.icon.hidden = YES;
    [self setNeedsLayout];
    [self layoutIfNeeded];
    CGFloat margin = 5;
    CGFloat imgX = margin;
    CGFloat imgY = margin;
    CGFloat imgW = (_fileCoverView.width - 3 * margin) / 2;
    CGFloat cHeight;
    if ([[ECRMultiObject sharedInstance] userInterfaceIdiom] == UIUserInterfaceIdiomPad) {
        cHeight = 170;
    }else{
        if (Screen_Width < 414){
            cHeight = 100;
        }else{
            cHeight = 130;
        }
    }
    CGFloat imgH = (cHeight - 3 * margin) / 2;
    //    CGFloat imgH = (_fileCoverView.height - 3 * margin) / 2;
    NSInteger count = (_model.books.count > 4) ? 4 : _model.books.count;
    //    NSLog(@"filecoverview.frame -- %@",NSStringFromCGRect(_fileCoverView.frame));
    for (NSInteger idx = 0; idx < count; idx++) {
        ECRBookrackModel *obj = _model.books[idx];
        UIImageView *fileBookCover = [[UIImageView alloc] init];
        
        CGFloat ex_line_num = 0;
        if (idx > 1) {
            ex_line_num = 2;
            imgY = margin * 2 + imgH;
        }
        //        NSLog(@"idx%ld --Y: %f",idx,imgY);
        imgX = margin * (idx + 1 - ex_line_num) + imgW * (idx - ex_line_num);
        fileBookCover.frame = CGRectMake(imgX, imgY, imgW, imgH);
        fileBookCover.contentMode = UIViewContentModeScaleAspectFill;
        fileBookCover.clipsToBounds = YES;
        [fileBookCover sd_setImageWithURL:[NSURL URLWithString:obj.iconUrl] placeholderImage:LGPlaceHolderImg];
        [_fileCoverView addSubview:fileBookCover];
    }
    
}

@end



