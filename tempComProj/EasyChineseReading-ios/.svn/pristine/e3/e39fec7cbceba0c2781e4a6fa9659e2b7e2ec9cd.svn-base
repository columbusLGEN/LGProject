//
//  ECREpubReader.m
//  EasyChineseReading-ios
//
//  Created by Peanut Lee on 2017/9/21.
//  Copyright © 2017年 retech. All rights reserved.
//

#import "ECREpubReader.h"
//#import "ECRLocalFileManager.h"
#import <YMEpubReaderKit/YMEpubReaderKit.h>
#import <YMEpubReaderKit/Bookmark.h>

@interface ECREpubReader ()<
YMEpubReaderManagerDelegate
>

@property (strong,nonatomic) NSArray *localTestBooks;//
@property (strong,nonatomic) YMEpubReaderManager *ymepubReader;//

@end

@implementation ECREpubReader

// read
- (void)readBook:(MyBook *)book fromController:(UIViewController *)vc{
//    NSLog(@"book -- %@",book);
    [self.ymepubReader readBook:book fromController:vc];
    
}

- (void)getTestBooks:(void(^)(NSArray<MyBook *> *books,NSString *info))completeBlock{
    if (completeBlock) {
        if (self.ymepubReader.bookArray) {
            completeBlock(self.ymepubReader.bookArray,@"加载完成");
        }else{
            completeBlock(nil,@"本地书籍还未加载完成，请稍后");
        }
    }
    
}

- (void)loadBookList{
    // 创建文件路径
    NSString *path = [[NSBundle mainBundle] pathForResource:@"book" ofType:@"bundle"];
    NSLog(@"path -- %@",path);
    NSLog(@"home -- %@",NSHomeDirectory());

    [self.ymepubReader loadBooksOfDirectoryAtPath:path completeBlock:^(NSArray<MyBook *> *bookArray, NSError *error) {
//        self.localTestBooks = bookArray;
        NSLog(@"ymepubReader.bookArray %@",bookArray);
    }];
    // 加载书籍
    
}

#pragma mark - YMEpubReaderManagerDelegate
// read controller 生命周期 回调
- (void)willBeginRead{
    NSLog(@"willBeginRead");
}
- (void)didBeginRead{
    NSLog(@"didBeginRead");
}
- (void)willEndRead{
    NSLog(@"willEndRead");
}
- (void)didEndRead{
    NSLog(@"didEndRead");
}

- (void)didAddDigest:(BookDigest *)digest{

}     //添加书摘或笔记，对应回调
- (void)didDeleteDigest:(BookDigest *)digest{

}
- (void)didAddBookMark:(Bookmark *)bookMark{

}   //添加书签，对应回调
- (void)didDeleteBookMark:(Bookmark *)bookMark{

}

+ (instancetype)sharedEpubReader{
    static id instance;
    static dispatch_once_t once;
    dispatch_once(&once, ^{
        instance = [self new];
    });
    return instance;
}
- (YMEpubReaderManager *)ymepubReader{
    if (_ymepubReader == nil) {
        _ymepubReader = [YMEpubReaderManager shardInstance];
        _ymepubReader.delegate = self;
    }
    return _ymepubReader;
}
//- (NSArray *)localTestBooks{
//    if (_localTestBooks == nil) {
//        
//    }
//}

@end
