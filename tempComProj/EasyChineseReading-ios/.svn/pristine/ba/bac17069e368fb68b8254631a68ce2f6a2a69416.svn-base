//
//  UCRBooksSelectedView.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 2017/9/15.
//  Copyright © 2017年 lee. All rights reserved.
//

#import "UCRBooksSelectedView.h"

#import "UCRBooksSelectedTableViewCell.h"
#import "UCRecommendBooksVC.h"

@interface UCRBooksSelectedView ()<UITableViewDelegate, UITableViewDataSource, UCRBooksSelectedTableViewCellDelegate>

@end

@implementation UCRBooksSelectedView

#pragma mark - 初始化

- (instancetype)initWithFrame:(CGRect)frame withObjects:(NSMutableArray *)objects{
    
    return [self initWithFrame:frame withObjects:objects canReorder:NO];
}

- (instancetype)initWithFrame:(CGRect)frame withObjects:(NSMutableArray *)objects canReorder:(BOOL)reOrder{
    
    self = [super initWithFrame:frame];
    
    if (self) {
        
        self.objects = [NSMutableArray arrayWithArray:objects];
        [self configBooksSelectedView];
    }
    return self;
}

#pragma mark - 配置界面

- (void)configBooksSelectedView
{
    self.backgroundColor = [[UIColor whiteColor] colorWithAlphaComponent:0.7];
    _tableView = [[UITableView alloc] initWithFrame:self.bounds];
    _tableView.delegate = self;
    _tableView.dataSource = self;
    _tableView.bounces = NO;
    _tableView.showsHorizontalScrollIndicator = NO;
    _tableView.showsVerticalScrollIndicator = NO;
    _tableView.backgroundColor = [UIColor clearColor];
    [self addSubview:_tableView];
    
    [_tableView registerNib:[UINib nibWithNibName:NSStringFromClass([UCRBooksSelectedTableViewCell class]) bundle:nil]
     forCellReuseIdentifier:NSStringFromClass([UCRBooksSelectedTableViewCell class])];
}

#pragma mark - UITableViewDelegate

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return [self.objects count];
}

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
    
    return cHeaderHeight_54;
}

- (UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section
{
    UIView *header = [UIView new];
    header.backgroundColor = [UIColor cm_graryColor_807F7F_1];
    
    UIView *verLine = [UIView new];
    verLine.backgroundColor = [UIColor cm_purpleColor_82056B_1];
    [header addSubview:verLine];
    [verLine mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.equalTo(header.mas_centerY);
        make.left.equalTo(header.mas_left).offset(12);
        make.size.mas_equalTo(CGSizeMake(3, 14));
    }];
    
    UILabel *lblDesc = [UILabel new];
    lblDesc.textColor = [UIColor cm_blackColor_333333_1];
    lblDesc.text = @"选中图书";
    lblDesc.font = [UIFont systemFontOfSize:15.f];
    [header addSubview:lblDesc];
    [lblDesc mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.equalTo(verLine.mas_centerY);
        make.left.equalTo(verLine.mas_right).offset(10);
    }];
    
    UIButton *btnClear = [UIButton new];
    [btnClear setTitle:@"" forState:UIControlStateNormal];
    [btnClear setTitleColor:[UIColor cm_blackColor_333333_1] forState:UIControlStateNormal];
    [btnClear setImage:[UIImage imageNamed:@"my2"] forState:UIControlStateNormal];
    [btnClear addTarget:self action:@selector(removeAllSelectedBooks) forControlEvents:UIControlEventTouchUpInside];
    [header addSubview:btnClear];
    [btnClear mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.equalTo(verLine.mas_centerY);
        make.right.equalTo(header.mas_right).offset(-20);
    }];
    
    return header;
}

- (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section
{
    return 44.f;
}

#pragma mark - UITableViewDataSource

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    
    UCRBooksSelectedTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:NSStringFromClass([UCRBooksSelectedTableViewCell class]) forIndexPath:indexPath];
    
    cell.delegate = self;
    cell.data = [self.objects objectAtIndex:indexPath.row];
    
    return cell;
}

#pragma mark - 

- (void)removeSelectedBook:(id)book
{
    [[NSNotificationCenter defaultCenter] postNotificationName:kNotificationRemoveSelectedBook object:book userInfo:nil];
}

- (void)removeAllSelectedBooks
{
    [[NSNotificationCenter defaultCenter] postNotificationName:kNotificationRemoveAllBooks object:nil];
}

@end
