//
//  ZPickDateView.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 17/9/6.
//  Copyright © 2017年 lee. All rights reserved.
//

#import "ZPickDateView.h"

static id instance = nil;

@interface ZPickDateView ()
@property (strong, nonatomic) IBOutlet UIButton *btnCancel;
@property (strong, nonatomic) IBOutlet UIButton *btnSure;
@property (strong, nonatomic) IBOutlet UIView *viewBackground;
@property (strong, nonatomic) IBOutlet UIDatePicker *datePickerView;

@end

@implementation ZPickDateView

/**
 *  创建实体
 *
 *  @return 实体
 */
+ (instancetype)createInstance
{
    CGRect frame = CGRectMake(0, 0, Screen_Width, 260);
    return [ZPickDateView loadFromNibWithFrame:frame];
}
/**
 *  开放实体单例
 *
 *  @return 实体单例
 */
+ (instancetype)sharedInstance
{
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        instance = [self createInstance];
    });
    return instance;
}

/**
 *  配置初始界面
 */
- (void)awakeFromNib
{
    [super awakeFromNib];
    
    _datePickerView.datePickerMode = UIDatePickerModeDate;
    
    NSDate *now = [[NSDate alloc] init];
    [_datePickerView setDate:now animated:YES];
    [_datePickerView setMaximumDate:now];
    [_datePickerView addTarget:self action:@selector(scrolling) forControlEvents:UIControlEventAllEvents];
    
    _btnSure.hidden = YES;
}
/**
 *  滚动选择时间时
 */
- (void)scrolling
{
    _btnSure.hidden = NO;
}
/**
 *  是否弹出日期选择器
 */
- (BOOL)showing
{
    return (self.superview!=nil);
}
/**
 *  弹出日期选择器
 */
- (void)show
{
    if ([self showing]) {
        return;
    }
    
    UIWindow *window = [UIApplication sharedApplication].keyWindow;
    [window addSubview:self];
    
    self.top = Screen_Height;
    [UIView animateWithDuration:0.25 delay:0 options:UIViewAnimationOptionCurveEaseIn animations:^{
        _btnSure.hidden = YES;
        self.top = self.top - self.height;
    } completion:^(BOOL finished) {
        //        if (finished) {
        //            window.rootViewController.view.userInteractionEnabled = NO;
        //        }
    }];
}
/**
 *  隐藏日期选择器
 */
- (void)hidden
{
    //    UIWindow *window = [AppDelegate sharedInstance].window;
    [UIView animateWithDuration:0.25 delay:0 options:UIViewAnimationOptionCurveEaseOut animations:^{
        self.top = self.top + self.height;
    } completion:^(BOOL finished){
        //        if (finished) {
        [self removeFromSuperview];
        //            window.rootViewController.view.userInteractionEnabled = YES;
        //        }
    }];
}

/**
 *  时间
 *
 *  @return 日期选择器上的时间
 */
- (NSDate *)date
{
    return _datePickerView.date;
}

- (IBAction)click_btnSure:(id)sender {
    if ([self.delegete respondsToSelector:@selector(datePickerView:selectedDate:)]) {
        [self.delegete datePickerView:self selectedDate:self.datePickerView.date];
    }
}
- (IBAction)click_btnCancel:(id)sender {
    if ([self.delegete respondsToSelector:@selector(datePickerViewCancel:)]) {
        [self.delegete datePickerViewCancel:self];
    }
}

@end
