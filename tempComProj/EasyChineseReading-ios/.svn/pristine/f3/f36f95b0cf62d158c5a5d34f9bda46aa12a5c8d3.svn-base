//
//  PaySuccessViewController.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 2017/11/7.
//  Copyright © 2017年 retech. All rights reserved.
//

#import "PaySuccessViewController.h"

#import "UOrderDetailVC.h"

static CGFloat const kButtonWidth = 100;

@interface PaySuccessViewController ()

//@property (strong, nonatomic) UIView  *viewNav;     // 仿 nav
//@property (strong, nonatomic) UIView  *viewLine;    // 横线
//@property (strong, nonatomic) UILabel *lblNavTitle; // 仿 nav 标题

@property (strong, nonatomic) UIImageView *imgSuccess;

@property (strong, nonatomic) UILabel *lblDescPayType;  // 支付类别描述
@property (strong, nonatomic) UILabel *lblDescPayPrice; // 支付金额描述
@property (strong, nonatomic) UILabel *lblPayType;  // 支付类别 (全平台包月, 系列包月, 充值, 购买)
@property (strong, nonatomic) UILabel *lblPayPrice; // 支付金额
@property (strong, nonatomic) UILabel *lblDescribe; // 注意

// 购买用
@property (strong, nonatomic) UIButton *btnDetail;   // 到订单详情
@property (strong, nonatomic) UIButton *btnHome;     // 返回首页

@end

@implementation PaySuccessViewController

- (void)viewDidLoad {
    [super viewDidLoad];
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

#pragma mark - 配置界面

- (void)createNavLeftBackItem
{
    UIButton *backButton = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 44, 44)];
    UIBarButtonItem *back = [[UIBarButtonItem alloc] initWithCustomView:backButton];
    self.navigationItem.leftBarButtonItems = @[back];
    self.navigationController.interactivePopGestureRecognizer.delegate = (id)self;// 解决自定义导航栏按钮导致系统的左滑pop 失效
}

- (void)updateSystemLanguage    
{
    [self configNavigationBar];
    [self configSuccessView];
}

- (void)configNavigationBar
{
    // 仿写 nav
//    _viewNav = [UIView new];
//    _viewNav.backgroundColor = [UIColor whiteColor];
//    [self.view addSubview:_viewNav];
//
//    [_viewNav mas_makeConstraints:^(MASConstraintMaker *make) {
//        make.left.equalTo(self.view.mas_left);
//        make.top.equalTo(self.view.mas_top);
//        make.right.equalTo(self.view.mas_right);
//        make.height.mas_equalTo(cHeaderHeight_64);
//    }];
//
//    _viewLine = [UIView new];
//    _viewLine.backgroundColor = [UIColor cm_lineColor_D9D7D7_1];
//    [_viewNav addSubview:_viewLine];
//
//    [_viewLine mas_makeConstraints:^(MASConstraintMaker *make) {
//        make.left.equalTo(_viewNav.mas_left);
//        make.right.equalTo(_viewNav.mas_right);
//        make.bottom.equalTo(_viewNav.mas_bottom);
//        make.height.mas_equalTo(.5);
//    }];
    
    self.title = LOCALIZATION(@"支付成功");
//    _lblNavTitle = [UILabel new];
//    _lblNavTitle.textColor = [UIColor cm_blackColor_333333_1];
//    _lblNavTitle.font = [UIFont boldSystemFontOfSize:cFontSize_16];
//    _lblNavTitle.textAlignment = NSTextAlignmentCenter;
//    _lblNavTitle.text = LOCALIZATION(@"支付成功");
//    [_viewNav addSubview:_lblNavTitle];
//
//    [_lblNavTitle mas_makeConstraints:^(MASConstraintMaker *make) {
//        make.centerX.equalTo(_viewNav.mas_centerX);
//        make.centerY.equalTo(_viewNav.mas_centerY).offset(10);
//    }];
}

- (void)configSuccessView
{
    _imgSuccess = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"img_success"]];
    [self.view addSubview:_imgSuccess];
    
    [_imgSuccess mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.equalTo(self.view.mas_centerX);
        make.bottom.equalTo(self.view.mas_centerY).offset(-90 - 45);
    }];
    
    _lblDescPayType = [UILabel new];
    _lblDescPayType.font = [UIFont systemFontOfSize:cFontSize_16];
    _lblDescPayType.textColor = [UIColor cm_blackColor_666666_1];
    _lblDescPayType.text = LOCALIZATION(@"支付类型:");
    [self.view addSubview:_lblDescPayType];
    
    [_lblDescPayType mas_makeConstraints:^(MASConstraintMaker *make) {
        make.right.equalTo(self.view.mas_centerX);
        make.bottom.equalTo(self.view.mas_centerY).offset(-90);
    }];

    _lblPayType = [UILabel new];
    _lblPayType.font = [UIFont systemFontOfSize:cFontSize_16];
    _lblPayType.textColor = [UIColor cm_orangeColor_FF5910_1];

    [self.view addSubview:_lblPayType];

    [_lblPayType mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(self.view.mas_centerX).offset(3);
        make.bottom.equalTo(self.view.mas_centerY).offset(-90);
    }];
    
    _lblDescPayType = [UILabel new];
    _lblDescPayType.font = [UIFont systemFontOfSize:cFontSize_16];
    _lblDescPayType.textColor = [UIColor cm_blackColor_666666_1];
    _lblDescPayType.text = LOCALIZATION(@"订单金额:");
    [self.view addSubview:_lblDescPayType];

    [_lblDescPayType mas_makeConstraints:^(MASConstraintMaker *make) {
        make.right.equalTo(self.view.mas_centerX);
        make.bottom.equalTo(self.view.mas_centerY).offset(-50);
    }];

    _lblPayPrice = [UILabel new];
    _lblPayPrice.font = [UIFont systemFontOfSize:cFontSize_16];
    _lblPayPrice.textColor = [UIColor cm_orangeColor_FF5910_1];
    [self.view addSubview:_lblPayPrice];

    [_lblPayPrice mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(self.view.mas_centerX).offset(3);
        make.bottom.equalTo(self.view.mas_centerY).offset(-50);
    }];

    
    switch (_order.orderType) {
        case ENUM_PayPurposeAllLease:
            _lblPayType.text = LOCALIZATION(@"全平台包月");
            _lblPayPrice.text = [NSString stringWithFormat:@"%@ %.2f", LOCALIZATION(@"¥"), _order.rechargeMoney];
            break;
        case ENUM_PayPurposeLease:
        case ENUM_PayPurposeContinue:
            _lblPayType.text = LOCALIZATION(@"系列包月");
            _lblPayPrice.text = [NSString stringWithFormat:@"%@ %.2f", LOCALIZATION(@"¥"), _order.rechargeMoney];
            break;
        case ENUM_PayPurposeBuy:
            _lblPayType.text = LOCALIZATION(@"购买图书");
            _lblPayPrice.text = [NSString stringWithFormat:@"%@ %.2f", LOCALIZATION(@"¥"), _order.rechargeMoney];
            break;
        case ENUM_PayPurposeRecharge:
            _lblPayType.text = LOCALIZATION(@"充值虚拟币");
            _lblPayPrice.text = [NSString stringWithFormat:@"%@ %.2f", LOCALIZATION(@"¥"), _order.rechargeMoney];
            break;
        default:
            break;
    }
    
    _btnDetail = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, kButtonWidth, cButtonHeight_40)];
    [_btnDetail setTitle:LOCALIZATION(@"查看订单") forState:UIControlStateNormal];
    [_btnDetail setTitleColor:[UIColor cm_mainColor] forState:UIControlStateNormal];
    [_btnDetail addTarget:self action:@selector(toOrderDetailWithOrder) forControlEvents:UIControlEventTouchUpInside];
    _btnDetail.backgroundColor = [UIColor whiteColor];
    _btnDetail.layer.cornerRadius = cButtonHeight_40/2;
    _btnDetail.layer.masksToBounds = YES;
    _btnDetail.layer.borderColor = [UIColor cm_mainColor].CGColor;
    _btnDetail.layer.borderWidth = 1.f;
    [self.view addSubview:_btnDetail];
    _btnDetail.hidden = _order.orderType != ENUM_PayPurposeBuy;
    
    [_btnDetail mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.equalTo(self.view.mas_centerY);
        make.right.equalTo(self.view.mas_centerX).offset(-22);
        make.size.mas_equalTo(CGSizeMake(kButtonWidth, cButtonHeight_40));
    }];
    
    _btnHome = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, kButtonWidth, cButtonHeight_40)];
    [_btnHome setTitle:LOCALIZATION(@"返回首页") forState:UIControlStateNormal];
    [_btnHome setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
    [_btnHome addTarget:self action:@selector(toHome) forControlEvents:UIControlEventTouchUpInside];
    _btnHome.backgroundColor = [UIColor cm_mainColor];
    _btnHome.layer.cornerRadius = cButtonHeight_40/2;
    _btnHome.layer.masksToBounds = YES;
    [self.view addSubview:_btnHome];
    
    [_btnHome mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.equalTo(self.view.mas_centerY);
        make.centerX.equalTo(self.view.mas_centerX).offset(_order.orderType == ENUM_PayPurposeBuy ? (kButtonWidth + 22)/2 : 0);
        make.size.mas_equalTo(CGSizeMake(_order.orderType == ENUM_PayPurposeBuy ? kButtonWidth : Screen_Width - 86*2, cButtonHeight_40));
    }];
    
    _lblDescribe = [UILabel new];
    _lblDescribe.textColor = [UIColor cm_blackColor_666666_1];
    _lblDescribe.font = [UIFont systemFontOfSize:cFontSize_12];
    _lblDescribe.textAlignment = NSTextAlignmentCenter;
    _lblDescribe.numberOfLines = 0;
    _lblDescribe.text = LOCALIZATION(@"注意: Easy Chinese Reading 平台及销售商不会已订单异常, 系统升级为由要求您点击任何网址链接进行退款操作.");
    [self.view addSubview:_lblDescribe];
    
    [_lblDescribe mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.equalTo(_btnHome.mas_bottom).offset(45);
        make.left.greaterThanOrEqualTo(self.view.mas_left).offset(25);
        make.centerX.equalTo(self.view.mas_centerX);
    }];
}

#pragma mark -

- (void)toOrderDetailWithOrder
{
    UOrderDetailVC *orderDetail = [UOrderDetailVC new];
    orderDetail.order = _order;
    [self.navigationController pushViewController:orderDetail animated:YES];
}

- (void)toHome
{
    [self fk_postNotification:kNotificationSelectHome];
    [self.navigationController popToRootViewControllerAnimated:YES];
}

@end
