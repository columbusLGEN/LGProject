//
//  UserCollectionHeaderView.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 17/8/29.
//  Copyright © 2017年 lee. All rights reserved.
//

#import "UserCollectionHeaderView.h"

@interface UserCollectionHeaderView ()

@property (strong, nonatomic) IBOutlet UIImageView *imgAvatar;      // 头像
@property (strong, nonatomic) IBOutlet UIImageView *imgBackground;  // 背景图

@property (strong, nonatomic) IBOutlet UIView *viewTopLine;
@property (strong, nonatomic) IBOutlet UIView *viewVerLine;
@property (strong, nonatomic) IBOutlet UIView *viewBottomTopLine;
@property (strong, nonatomic) IBOutlet UIView *viewBottomBottomLine;
@property (strong, nonatomic) IBOutlet UIView *viewBottomCenterLine;

@property (strong, nonatomic) IBOutlet UIView *viewBottom;

@property (strong, nonatomic) IBOutlet UILabel *lblLogin;       // 登录
@property (strong, nonatomic) IBOutlet UILabel *lblIntegral;    // 积分
@property (strong, nonatomic) IBOutlet UILabel *lblMoney;       // 虚拟币

@property (strong, nonatomic) IBOutlet UILabel *lblDesReaded;   // 描述 读完
@property (strong, nonatomic) IBOutlet UILabel *lblDesReading;  // 描述 已读
@property (strong, nonatomic) IBOutlet UILabel *lblDesReadTime; // 描述 总阅读小时
@property (strong, nonatomic) IBOutlet UILabel *lblDesReadWords;// 描述 今天阅读字数

@property (strong, nonatomic) IBOutlet UILabel *lblReaded;       // 读完
@property (strong, nonatomic) IBOutlet UILabel *lblReading;      // 已读
@property (strong, nonatomic) IBOutlet UILabel *lblReadTime;     // 总阅读小时
@property (strong, nonatomic) IBOutlet UILabel *lblReadWords;    // 今天阅读字数
@property (strong, nonatomic) IBOutlet UILabel *lblRanking;      // 阅读排名

@property (strong, nonatomic) IBOutlet UIButton *btnShowing;     // 晒一晒

@property (weak, nonatomic) IBOutlet NSLayoutConstraint *topViewHeightConstraint;   // 顶部 view 高度 - 登录
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *midViewHeightConstraint;   // 中间 view 高度 - 晒一晒
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *btnHeightConstraint;       // 晒一晒高度
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *btnWidthConstraint;        // 晒一晒宽度
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *imgHeightConstraint;       // 头像高度

@property (weak, nonatomic) IBOutlet NSLayoutConstraint *topDescHeightConstraint;   // 顶部描述距离顶部高度
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *botDescHeightConstraint;   // 底部描述距离顶部高度
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *topLblHeightConstraint;    // 顶部内容距离上面高度
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *botLblHeightConstraint;    // 底部内容距离上面高度


@end

@implementation UserCollectionHeaderView

- (void)awakeFromNib
{
    [super awakeFromNib];
    [self configManager];
}

#pragma mark -
#pragma mark 配置 个人中心 header 界面

- (void)configManager
{
    [self configHeaderView];
    [self configHeaderViewMainColor:[UIColor cm_purpleColor_82056B_1]];
    [self configHeaderLineColor:[UIColor cm_lineColor_D9D7D7_1]];
    [self configGestureRecognizer];
    [self configHeaderFont:isPad ? cFontSize_iPad_18 : cFontSize_16];
}

- (void)configHeaderView
{
    _topViewHeightConstraint.constant = isPad ? 150.f : 100.f;
    _midViewHeightConstraint.constant = isPad ? 80.f : 60.f;
    _btnHeightConstraint.constant     = isPad ? 48.f : 30.f;
    _imgHeightConstraint.constant     = isPad ? 86.f : 48.f;
    
    _btnWidthConstraint.constant = isPad ? 130.f : 80.f;
    
    _topDescHeightConstraint.constant = isPad ? 20.f : 10.f;
    _topLblHeightConstraint.constant  = isPad ? 20.f : 10.f;
    _botDescHeightConstraint.constant = isPad ? 20.f : 10.f;
    _botLblHeightConstraint.constant  = isPad ? 20.f : 10.f;

    _imgAvatar.layer.borderColor = [UIColor whiteColor].CGColor;
    _imgAvatar.layer.borderWidth = 3.f;
    _imgAvatar.layer.cornerRadius = _imgHeightConstraint.constant/2;
    
    _imgAvatar.layer.shadowColor = [UIColor blackColor].CGColor;
    _imgAvatar.layer.shadowOffset = CGSizeMake(0, 0);
    _imgAvatar.layer.shadowOpacity = 0.5f;
    
    _lblDesReaded.textColor     = [UIColor cm_blackColor_333333_1];
    _lblDesReading.textColor    = [UIColor cm_blackColor_333333_1];
    _lblDesReadTime.textColor   = [UIColor cm_blackColor_333333_1];
    _lblDesReadWords.textColor  = [UIColor cm_blackColor_333333_1];
    
    _btnShowing.layer.masksToBounds = YES;
    _btnShowing.layer.cornerRadius = _btnHeightConstraint.constant/2;
    
    NSMutableAttributedString *ranking = [[NSMutableAttributedString alloc] initWithString:[NSString stringWithFormat:@"我战胜了 0%% 的书友"]];
    // 获取要调整颜色的文字位置,调整颜色
    NSRange rangePercent = [[ranking string] rangeOfString:@"0%"];
    NSRange upRange = NSMakeRange(rangePercent.location, rangePercent.length);
    [ranking addAttribute:NSForegroundColorAttributeName value:[UIColor cm_purpleColor_82056B_1] range:upRange];
    _lblRanking.attributedText = ranking;
}

- (void)configHeaderFont:(NSInteger)fontSize
{
    _lblReaded.font = [UIFont systemFontOfSize:fontSize];
    _lblReading.font = [UIFont systemFontOfSize:fontSize];
    _lblReadTime.font = [UIFont systemFontOfSize:fontSize];
    _lblReadWords.font = [UIFont systemFontOfSize:fontSize];
    
    _lblDesReaded.font = [UIFont systemFontOfSize:fontSize];
    _lblDesReading.font = [UIFont systemFontOfSize:fontSize];
    _lblDesReadTime.font = [UIFont systemFontOfSize:fontSize];
    _lblDesReadWords.font = [UIFont systemFontOfSize:fontSize];
    
    _lblRanking.font = [UIFont systemFontOfSize:fontSize];
    
    _lblMoney.font = [UIFont systemFontOfSize:fontSize];
    _lblIntegral.font = [UIFont systemFontOfSize:fontSize];
    
    _lblLogin.font = [UIFont systemFontOfSize:isPad ? 20 : 18];
}

- (void)configHeaderViewMainColor:(UIColor *)mainColor
{
    _lblReaded.textColor = mainColor;
    _lblReading.textColor = mainColor;
    _lblReadTime.textColor = mainColor;
    _lblReadWords.textColor = mainColor;
    
    _btnShowing.backgroundColor = mainColor;
    _viewVerLine.backgroundColor = mainColor;
}

- (void)configHeaderLineColor:(UIColor *)lineColor
{
    _viewBottom.layer.borderWidth = 1.f;
    _viewBottom.layer.borderColor = lineColor.CGColor;
    
    _viewBottomTopLine.backgroundColor = lineColor;
    _viewBottomBottomLine.backgroundColor = lineColor;
    _viewBottomCenterLine.backgroundColor = lineColor;
}

#pragma mark 添加手势

- (void)configGestureRecognizer
{
    UITapGestureRecognizer *tap_imgAvatar = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapImageAvatar:)];
    [_imgAvatar addGestureRecognizer:tap_imgAvatar];
    
    UITapGestureRecognizer *tap_login = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapLblLoginOrUserInfo:)];
    [_lblLogin addGestureRecognizer:tap_login];
    
    UITapGestureRecognizer *tap_integral = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapLblIntegral:)];
    [_lblIntegral addGestureRecognizer:tap_integral];
    
    UITapGestureRecognizer *tap_virCurrency = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapLblVirtualCurrency:)];
    [_lblMoney addGestureRecognizer:tap_virCurrency];
}


#pragma mark -
#pragma mark 获取数据

- (void)dataDidChange
{
    UserModel *user = self.data;
    
    if (user) {
        NSString *name = @"";
        if (user.name.length > 0) {
            name = user.name;
        }
        else if (user.phone.length > 0) {
            name = user.phone;
        }
        else if (user.email.length > 0) {
            name = user.email;
        }
        _lblLogin.text = name;
        
        [_imgAvatar sd_setImageWithURL:[NSURL URLWithString:user.iconUrl] placeholderImage:[UIImage imageNamed:@"tx"]];
        
        _lblIntegral.text = [NSString stringWithFormat:@"积分:%ld", (long)user.score];
        _lblMoney.text = [NSString stringWithFormat:@"虚拟币:%ld", (long)user.virtualCurrency];
        
        NSMutableAttributedString *ranking = [[NSMutableAttributedString alloc] initWithString:[NSString stringWithFormat:@"我战胜了 %ld%% 的书友", (long)user.ranking]];
        // 获取要调整颜色的文字位置,调整颜色
        NSRange rangeSpace   = [[ranking string] rangeOfString:@" "];
        NSRange rangePercent = [[ranking string] rangeOfString:@"%"];
        // 更新第一个空格到%之间的范围
        NSRange upRange = NSMakeRange(rangeSpace.location + 1, rangePercent.location + 1 - rangeSpace.location);
        [ranking addAttribute:NSForegroundColorAttributeName value:[UIColor cm_purpleColor_82056B_1] range:upRange];
        _lblRanking.attributedText = ranking;
        
        _lblReaded.text = [NSString stringWithFormat:@"%ld册", (long)user.readThrough];
        _lblReading.text = [NSString stringWithFormat:@"%ld册", (long)user.readHave];
        _lblReadTime.text = [NSString stringWithFormat:@"%ld小时", (long)user.readTime];
        _lblReadWords.text = [NSString stringWithFormat:@"%ld字", (long)user.sameDayWord];
    }
}

#pragma mark -
#pragma mark 用户交互

// 点击头像
- (void)tapImageAvatar:(UITapGestureRecognizer *)sender
{
    if ([self.delegate respondsToSelector:@selector(tapAvatar)]) {
        [self.delegate tapAvatar];
    }
}

// 登录或者查看个人信息
- (void)tapLblLoginOrUserInfo:(UITapGestureRecognizer *)sender
{
    if ([self.delegate respondsToSelector:@selector(tapLoginOrUserInfo)]) {
        [self.delegate tapLoginOrUserInfo];
    }
}

// 查看积分
- (void)tapLblIntegral:(UITapGestureRecognizer *)sender
{
    if ([self.delegate respondsToSelector:@selector(tapIntegral)]) {
        [self.delegate tapIntegral];
    }
}

// 查看虚拟币
- (void)tapLblVirtualCurrency:(UITapGestureRecognizer *)sender
{
    if ([self.delegate respondsToSelector:@selector(tapVirtualCurrency)]) {
        [self.delegate tapVirtualCurrency];
    }
}

// 晒一晒
- (IBAction)click_btnShowing:(id)sender {
    if ([self.delegate respondsToSelector:@selector(shareMyReadingInfomation)]) {
        [self.delegate shareMyReadingInfomation];
    }
}

@end
