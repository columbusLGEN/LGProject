//
//  ECRHomeViewController.m
//  EasyChineseReading-ios
//
//  Created by lee on 2017/8/29.
//  Copyright © 2017年 lee. All rights reserved.
//

#import "ECRHomeViewController.h"
#import <WebKit/WebKit.h>// test
#import "ECRHomeMainModel.h"// 主view model
#import "ECRHomeMainView.h"// 主 view
#import "ECRHomeTitleView.h"// title view
#import "ECRMoreBooksViewController.h"// 更多
#import "ECRShoppingCarViewController.h"// 购物车
#import "ECRSearchBooksViewController.h"
#import "ECRBookInfoViewController.h"

@interface ECRHomeViewController ()<
ECRHomeTitleViewDelelgate,
ECRHomeMainViewDelegate
>
@property (strong,nonatomic) WKWebView *wk;// test
@property (strong,nonatomic) UIScrollView *scroll;// 备用
@property (strong,nonatomic) NSArray *imgNames;// test
@property (strong,nonatomic) ECRHomeMainView *mainView;

@end

@implementation ECRHomeViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    [self setupUI];
    
}

- (void)setupUI{
    self.automaticallyAdjustsScrollViewInsets = NO;
    self.view.backgroundColor = [UIColor whiteColor];
    
//    CGRect mvRect = CGRectMake(0, -64, Screen_Width, Screen_Height);
    _mainView = [[ECRHomeMainView alloc] initWithFrame:self.view.bounds];
    _mainView.delegate = self;
    self.view = _mainView;
    
    ECRHomeTitleView *tView = [[ECRHomeTitleView alloc] initWithFrame:CGRectMake(0, 0, Screen_Width, 64)];
    tView.delegate = self;
    self.navigationItem.titleView = tView;
    [self test];
}

- (void)test{
    // --------测试数据
    NSMutableArray *arrM = [NSMutableArray array];
    for (NSInteger i = 0; i < 6; ++i) {
        ECRHomeMainModel *model = [[ECRHomeMainModel alloc] init];
        model.imgTestURL = @"http://pic.qiantucdn.com/58pic/19/17/63/56837b8dd47fd_1024.jpg";
        [arrM addObject:model];
    }
    _imgNames = arrM.copy;

    // --------测试数据
    
//    _mainView = [[[NSBundle mainBundle] loadNibNamed:@"ECRHomeMainView" owner:nil options:nil] firstObject];
    
    // MARK: homeMainView模型赋值
    _mainView.models = arrM.copy;
        
}
#pragma mark - ECRHomeMainViewDelegate
- (void)hmView:(ECRHomeMainView *)hmView tag:(NSInteger)tag{
    if (tag <= 5) {
        // MARK: 跳转至分类页面
        // 0 热销
        // 1 互动教材
        // 2 汉语读物
        // 3 文化读物
        if (tag == 4) {
            // MARK: 接口调试
            // http://192.168.10.107:8080/UniversityPressService/books/books
            NSString *testURL = @"http://192.168.10.107:8080/UniversityPressService/books/books";
            NSMutableDictionary *dict  = [NSMutableDictionary dictionaryWithCapacity:10];
            NSMutableDictionary *param = [NSMutableDictionary dictionaryWithCapacity:10];
            param[@"imei"] = @"460030912121001";
            param[@"imsi"] = @"460030912121001";
            param[@"type"] = @"1";
            param[@"special"] = @"";
            param[@"classify"] = @"1";
            param[@"length"] = @"3";
            param[@"page"] = @"1";
            param[@"sort"] = @"1";
            dict[@"params"] = param;
            dict[@"md5"] = @"654c01acaf40e0ce6d841a552fd3b96c";
            
            [[ECRHTTPSessionManager sharedManager] lg_POSTWithURLString:testURL parameters:dict success:^(id responseObject) {
                
            } failure:^(NSError *error) {
                
            }];
            
        }else{
            [self sortTableViewTestWithType:tag];
        }
    }else{
        if (tag < 10) {
            UIStoryboard *board = [UIStoryboard storyboardWithName:@"BookInfo" bundle:nil];
            ECRBookInfoViewController *bInfo = [board instantiateViewControllerWithIdentifier:@"ECRBookInfoViewController"];
            bInfo.viewControllerPushWay = ECRBaseControllerPushWayPush;
            [self.navigationController pushViewController:bInfo animated:YES];
            return;
        }
        if (tag < 15) {// pdf
        
            return;
        }
        // 超媒体
        
    }
}

#pragma mark - ECRHomeTitleViewDelegate
- (void)htViewBeginSearch:(ECRHomeTitleView *)titleView{
    [self.view endEditing:YES];
    // MARK: 弹出搜索视图
    ECRSearchBooksViewController *test = [[ECRSearchBooksViewController alloc] init];
//    test.bookListType = 2;// 如何让搜索页面 显示全部筛选条件,但是默认不选中?
    test.viewControllerPushWay = ECRBaseControllerPushWayPush;
    [self.navigationController pushViewController:test animated:NO];
    
}
- (void)htView:(ECRHomeTitleView *)titlView sCarClick:(id)param{
    // MARK: 购物车
    ECRShoppingCarViewController *sc = [[ECRShoppingCarViewController alloc] init];
    sc.viewControllerPushWay = 0;
    [self.navigationController pushViewController:sc animated:YES];
}

// MARK: 创建分类页面
- (void)sortTableViewTestWithType:(ECRMoreBookListType)blType{
    NSString *vcTitle;
    switch (blType) {
        case ECRMoreBookListTypeHotSeal:
            vcTitle = @"热销图书";
            break;
        case ECRMoreBookListTypeInterText:
            vcTitle = @"互动教材";
            break;
        case ECRMoreBookListTypeChineseReading:
            vcTitle = @"汉语读物";
            break;
        case ECRMoreBookListTypeCultureReading:
            vcTitle = @"文化读物";
            break;
    }
    ECRMoreBooksViewController *test = [[ECRMoreBooksViewController alloc] init];
    test.title = vcTitle;
    test.bookListType = blType;
    test.viewControllerPushWay = ECRBaseControllerPushWayPush;
    [self.navigationController pushViewController:test animated:YES];
}

- (void)createNavLeftBackItem{
    // 重写,不做任何操作
}


@end
