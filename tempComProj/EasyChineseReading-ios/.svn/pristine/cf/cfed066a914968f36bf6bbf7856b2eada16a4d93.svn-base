!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("GREN")):"function"==typeof define&&define.amd?define("TRANSITION",["GREN"],t):"object"==typeof exports?exports.TRANSITION=t(require("GREN")):e.TRANSITION=t(e.GREN)}(this,function(e){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var n=r(4);Object.keys(n).forEach(function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})})},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Roll=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=function c(e,t,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var n=Object.getPrototypeOf(e);return null===n?void 0:c(n,t,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},l=r(2),u=r(3),h=t.Roll=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?300:arguments[0],r=arguments.length<=1||void 0===arguments[1]?100:arguments[1],o=arguments.length<=2||void 0===arguments[2]?"../bin/texture.png":arguments[2];i(this,t);var a=n(this,Object.getPrototypeOf(t).call(this));if(a.renderer=new u.WebGLRenderer,a.renderer.setStyle(e,r,"margin:0px; position:absolute; z-index:1;"),a.gl=a.renderer.gl,a.domElement=a.renderer.canvas,a.renderer.isWebGLSuported===!1)return n(a);e=a.renderer.canvasWidth,r=a.renderer.canvasHeight;var s=25/180*Math.PI;a.pMatrix=u.Matrix4.perspective(s,e/r,.1,2),a.mvMatrix=new u.Matrix4,u.Matrix4.translate(a.mvMatrix,[0,0,-.2]),u.Matrix4.scale(a.mvMatrix,[1/r,1/r,1/r]);var l=.2*Math.tan(s/2);u.Matrix4.scale(a.mvMatrix,[2*l,2*l,2*l]),u.Matrix4.translate(a.mvMatrix,[0,0,2.5*-a.renderer.canvasHeight]),u.Matrix4.rotate(a.mvMatrix,a.mvMatrix,-1.5,[1,0,0]),u.Matrix4.rotate(a.mvMatrix,a.mvMatrix,75/180*Math.PI,[0,0,1]),a.mvMatrix1=u.Matrix4.copy(a.mvMatrix),u.Matrix4.translate(a.mvMatrix1,[0,0,-1.5]),a._initProgram(),a.mesh=new u.PlaneGeometry(e,r,1,Math.floor(r/5));var h=a.gl.createArrayBufferWithTypedArray(a.mesh.vertices);a.gl.bindBuffer(a.gl.ARRAY_BUFFER,h),a.gl.vertexAttribPointer(a.prg.vertexPosition,3,a.gl.FLOAT,!1,0,0),a.gl.enableVertexAttribArray(a.prg.vertexPosition);var c=a.gl.createArrayBufferWithTypedArray(a.mesh.textureCoords);a.gl.bindBuffer(a.gl.ARRAY_BUFFER,c),a.gl.vertexAttribPointer(a.prg.vTextureCoord,2,a.gl.FLOAT,!1,0,0),a.gl.enableVertexAttribArray(a.prg.vTextureCoord);var f=a.gl.createElementBufferWithTypedArray(a.mesh.indices);return a.gl.bindBuffer(a.gl.ELEMENT_ARRAY_BUFFER,f),a.rollTo=0,a.isRollUp=!0,a._resetParams(),a.glTexture=new u.GLTexture2D(a.gl,o,function(){a.gl.activeTexture(a.gl.TEXTURE0),a.gl.bindTexture(a.gl.TEXTURE_2D,a.glTexture.texture),a.gl.uniform1i(a.prg.texture,0),a.startAnimating()}),a}return o(t,e),a(t,[{key:"_resetParams",value:function(){this.speed=Math.ceil(this.renderer.canvasHeight/180),this.accelerate=this.speed/15,this.needStop=!1}},{key:"_initProgram",value:function(){this.prg=this.gl.makeProgram(l.vertexShader,u.basicTextureFS),this.prg.setAttribLocations(["vertexPosition","vTextureCoord"]),this.prg.setUniformLocations(["pMatrix","mvMatrix","startRadius","rollTo","halfHeight","texture","useTexture","color"]),this.gl.uniformMatrix4fv(this.prg.pMatrix,!1,this.pMatrix),this.gl.uniform1f(this.prg.startRadius,30*window.devicePixelRatio),this.gl.uniform1f(this.prg.halfHeight,this.renderer.centerY),this.gl.uniform4fv(this.prg.color,[1,1,1,.95])}},{key:"rollUp",value:function(){this.stopAnimating(),this._resetParams(),this.isRollUp=!0,this.startAnimating()}},{key:"rollDown",value:function(){this.stopAnimating(),this._resetParams(),this.isRollUp=!1,this.startAnimating()}},{key:"updateData",value:function(){this.isRollUp?(this.rollTo+=this.speed,this.rollTo>=this.renderer.canvasHeight&&(this.rollTo=this.renderer.canvasHeight,this.needStop=!0)):(this.rollTo-=this.speed,this.rollTo<=0&&(this.rollTo=0,this.needStop=!0)),this.speed+=this.accelerate,this.gl.uniform1f(this.prg.rollTo,this.rollTo)}},{key:"enterFrame",value:function(){this.needStop===!1&&s(Object.getPrototypeOf(t.prototype),"enterFrame",this).call(this),this.updateData(),this.gl.clearColor(0,0,0,0),this.gl.viewport(0,0,this.renderer.canvasWidth,this.renderer.canvasHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.uniformMatrix4fv(this.prg.mvMatrix,!1,this.mvMatrix),this.gl.uniform1i(this.prg.useTexture,!0),this.gl.uniform1f(this.prg.startRadius,30*window.devicePixelRatio),this.gl.drawElements(this.gl.TRIANGLES,this.mesh.indices.length,this.gl.UNSIGNED_SHORT,0),this.gl.uniformMatrix4fv(this.prg.mvMatrix,!1,this.mvMatrix1),this.gl.uniform1i(this.prg.useTexture,!1),this.gl.uniform1f(this.prg.startRadius,30*window.devicePixelRatio+1),this.gl.drawElements(this.gl.TRIANGLES,this.mesh.indices.length,this.gl.UNSIGNED_SHORT,0)}}]),t}(u.IAnimation);window.Roll=h},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.vertexShader="\nattribute vec3 vertexPosition;\nattribute vec2 vTextureCoord;\n\nuniform mat4 mvMatrix;\nuniform mat4 pMatrix;\nuniform bool useTexture;\n\nuniform float startRadius; // 开始卷动的半径\nuniform float rollTo; // 卷动到哪个位置\nuniform float halfHeight; // 屏幕一半的高度,用来计算顶点离坐标离屏幕原点(左下角)的位置\n\nvarying vec2 texCoord;\n\nconst float PI = 3.1415926;\nvoid main(void) {\n    if (useTexture) {\n        texCoord = vTextureCoord;\n    }\n    // 离左下角的距离\n    float distance = halfHeight + vertexPosition.y;\n    if (distance < rollTo) {\n        float maxRadius = 1.5 * startRadius;\n        float stepRadius = (maxRadius - startRadius) / (halfHeight * 2.0) ;\n        // 每一点的卷动半径是不一样的\n        float newRadius = startRadius + stepRadius * distance;\n        // 卷动停止点的半径\n        float targetRadius = startRadius + stepRadius * rollTo;\n        \n         // 卷动的圆的周长\n        float perimeter = newRadius * 2.0 * PI;\n        //卷起的弧度,每一个顶点被卷起的弧度值是不一样的;\n        // float degress = ((rollTo-distance) / perimeter) * (2.0 * PI);\n        float degress = (mod((rollTo-distance), perimeter)  / perimeter) * (2.0 * PI);\n\n        vec3 newPosition = vertexPosition.xyz;\n        newPosition.y = (rollTo - sin(degress) * newRadius) - halfHeight;\n        newPosition.z  += (targetRadius - newRadius)/2.0 + (newRadius - cos(degress)*newRadius) + 1.0;\n        gl_Position = pMatrix * mvMatrix * vec4(newPosition, 1.0);\n    } else {\n        gl_Position = pMatrix * mvMatrix * vec4(vertexPosition, 1.0);\n    }\n   \n}\n"},function(t,r){t.exports=e},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PageTurning=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=function g(e,t,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var n=Object.getPrototypeOf(e);return null===n?void 0:g(n,t,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},u=r(5),h=i(u),c=r(6),f=t.PageTurning=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?300:arguments[0],r=arguments.length<=1||void 0===arguments[1]?100:arguments[1],i=arguments.length<=2||void 0===arguments[2]?"./bin/texture1.png":arguments[2];n(this,t);var a=o(this,Object.getPrototypeOf(t).call(this));if(a.renderer=new GREN.WebGLRenderer,a.renderer.setStyle(e,r,"margin:0px; position:absolute; z-index:1;"),a.gl=a.renderer.gl,a.gl.enable(a.gl.DEPTH_TEST),a.domElement=a.renderer.canvas,a.renderer.isWebGLSuported===!1)return o(a);e=a.renderer.canvasWidth,r=a.renderer.canvasHeight,a.pMatrix=GREN.Matrix4.orthogonal(-e/2,e/2,-r/2,r/2,-1e3,5e3),a.mvMatrix=new GREN.Matrix4,a.speed=[0,0],a.autoAnimating=!1,a.targetPosition=new GREN.Vector2,a.isRollToNext=!0,a.isTouchMoving=!1,a.radius=a.renderer.canvasWidth/8,a.halfCircle=Math.PI*a.radius,a.rollLength=0,a._initProgram();var s=8;return a.mesh=new GREN.PlaneGeometry(e,r,Math.floor(e/s),Math.floor(r/s)),a._bindBuffers(),a.glTexture=new GREN.GLTexture2D(a.gl,i,function(){a.gl.activeTexture(a.gl.TEXTURE0),a.gl.bindTexture(a.gl.TEXTURE_2D,a.glTexture.texture),a.gl.uniform1i(a.prg.texture,0),a.enterFrame()}),a.touchListener(),a}return a(t,e),s(t,[{key:"_bindBuffers",value:function(){this.vertexBuffer||(this.vertexBuffer=this.gl.createArrayBufferWithTypedArray(this.mesh.vertices),this.textureBuffer=this.gl.createArrayBufferWithTypedArray(this.mesh.textureCoords),this.indexBuffer=this.gl.createElementBufferWithTypedArray(this.mesh.indices)),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(this.prg.vertexPosition,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.prg.vertexPosition),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureBuffer),this.gl.vertexAttribPointer(this.prg.vTextureCoord,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.prg.vTextureCoord),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}},{key:"_initProgram",value:function(){this.prg=this.gl.makeProgram(c.vertexShader,c.fregmentShader),this.prg.setAttribLocations(["vertexPosition","vTextureCoord"]),this.prg.setUniformLocations(["pMatrix","mvMatrix","radius","texture","color","screenSize","rollLength","angle","np","n"]),this.gl.uniformMatrix4fv(this.prg.pMatrix,!1,this.pMatrix),this.gl.uniformMatrix4fv(this.prg.mvMatrix,!1,this.mvMatrix),this.gl.uniform1f(this.prg.radius,this.radius),this.gl.uniform2fv(this.prg.screenSize,[this.renderer.canvasWidth,this.renderer.canvasHeight])}},{key:"touchListener",value:function(){var e=this,t=function(t){!e.isAnimating&&e.needRolling&&(e.isTouchMoving=!0,e.currentPoint=e._getTouchPoint(t),e.updateData(e.currentPoint)&&e.enterFrame())},r=function(r){if(e.isTouchMoving=!1,!e.isAnimating&&e.needRolling){e.domElement.removeEventListener(h.TOUCH_MOVE,t),e.autoAnimating=!0,e.frames=[];var i=e.renderer.canvasWidth/3;e.isRollToNext||(e.rollLength=e.touchStart.x-e.currentPoint.x,i*=2.5);var n=e.renderer.canvasWidth/20;if(e.rollLength<i)e.frames=e.frames.concat(e.generateFrameData(e.currentPoint,e.touchStart,e.rollLength/n));else{var o=new GREN.Vector2(.5*-e.renderer.canvasWidth,e.touchStart.y),a=Math.sqrt(Math.pow(o.x-e.touchStart.x,2)+Math.pow(o.y-e.touchStart.y,2))/n;e.frames=e.frames.concat(e.generateFrameData(e.currentPoint,o,a));var s=new GREN.Vector2(1.5*-e.renderer.canvasWidth,e.touchStart.y);a=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2))/n,e.frames=e.frames.concat(e.generateFrameData(o,s,a))}e.startAnimating()}};this.domElement.addEventListener(h.TOUCH_START,function(r){if(!e.isAnimating&&!e.isTouchMoving){e.touchStart=e._getTouchPoint(r),e.currentPoint=e.touchStart,e.needRolling=!1;var i=40*window.devicePixelRatio;e.touchStart.x>=e.renderer.centerX-i?(e.isRollToNext=!0,e.needRolling=!0):e.touchStart.x<=-(e.renderer.centerX-i)&&(e.isRollToNext=!1,e.needRolling=!0,e.touchStart.x*=-1),e.needRolling&&e.domElement.addEventListener(h.TOUCH_MOVE,t)}}),this.domElement.addEventListener(h.TOUCH_END,r),this.domElement.addEventListener(h.TOUCH_CANCEL,r)}},{key:"generateFrameData",value:function(e,t,r){for(var i=(t.x-e.x)/r,n=(t.y-e.y)/r,o=[],a=0;a<r;a++)o.push(new GREN.Vector2(e.x+i*a,e.y+n*a));return o}},{key:"updateData",value:function(e){var t=this.touchStart.x-e.x,r=this.touchStart.y-e.y;if(0===t||!this.autoAnimating&&t<0)return!1;var i=Math.sqrt(t*t+r*r),n=Math.PI/2,o=Math.atan2(r,t),a=Math.sin(o),s=0;0===o?s=i:o<n&&o>-n&&(s=Math.abs(Math.cos(o)*this.renderer.canvasWidth)),this.rollLength=i,i>this.halfCircle&&(this.rollLength=(i-this.halfCircle)/2+this.halfCircle),this.rollLength>s&&(this.rollLength=s);var l=[this.renderer.centerX-Math.abs(Math.cos(o)*this.rollLength),this.renderer.centerY*(o>0?1:-1)-a*this.rollLength],u=[Math.cos(o),a];return this.gl.uniform1f(this.prg.rollLength,this.rollLength),this.gl.uniform1f(this.prg.angle,o),this.gl.uniform2fv(this.prg.np,l),this.gl.uniform2fv(this.prg.n,u),this.angle=o,!0}},{key:"nextStep",value:function(){var e=this.frames.shift();this.updateData(e),0===this.frames.length&&(this.autoAnimating=!1,this.needRolling=!1,this.stopAnimating())}},{key:"enterFrame",value:function(){this.autoAnimating&&(l(Object.getPrototypeOf(t.prototype),"enterFrame",this).call(this),this.nextStep()),this.gl.clearColor(0,0,0,0),this.gl.viewport(0,0,this.renderer.canvasWidth,this.renderer.canvasHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.drawElements(this.gl.TRIANGLES,this.mesh.indices.length,this.gl.UNSIGNED_SHORT,0)}},{key:"_getTouchPoint",value:function(e){var t=e.clientX||(e.touches&&e.touches.length>0?e.touches[0].clientX:e.changedTouches[0].clientX),r=e.clientY||(e.touches&&e.touches.length>0?e.touches[0].clientY:e.changedTouches[0].clientY);return t-=this.domElement.getBoundingClientRect().left,new GREN.Vector2(t*window.devicePixelRatio-this.renderer.centerX,this.renderer.centerY-r*window.devicePixelRatio)}}]),t}(GREN.IAnimation);window.PageTurning=f},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=t.TOUCH_START="mousedown",i=t.TOUCH_MOVE="mousemove",n=t.TOUCH_END="mouseup",o=t.TOUCH_CANCEL="mouseout";/Android|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle/i.test(navigator.userAgent)&&(t.TOUCH_START=r="touchstart",t.TOUCH_END=n="touchend",t.TOUCH_MOVE=i="touchmove",t.TOUCH_CANCEL=o="touchcancel")},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.vertexShader="\nattribute vec3 vertexPosition;\nattribute vec2 vTextureCoord;\n\nuniform mat4 mvMatrix;\nuniform mat4 pMatrix;\n\nuniform float radius; // 开始卷动的半径\nuniform float rollLength;\nuniform float angle;\nuniform vec2 np; \nuniform vec2 n;\n\nvarying vec2 texCoord;\nvarying vec3 verCoord;\n\nconst float PI = 3.1415926535;\nconst float PI_2 = 3.1415926535/2.0;\n\nvoid main(void) {\n    texCoord = vTextureCoord;\n    vec2 v = vertexPosition.xy-np;\n    float l = dot(v, n);\n        \n    if (l > 0.0) {\n        float halfCircle = PI * radius;\n        vec3 newPosition = vertexPosition.xyz;\n        // 切点到 halfCircle 之间的顶点计算卷起\n        float degress = PI_2;\n        float d = radius * PI; //l 卷起后与之前的位置差\n        if ( l <= halfCircle) {\n            degress = (l / halfCircle) * PI - PI_2 ;\n            d = l - cos(degress) * radius;\n            newPosition.y -= sin(angle) * d ;\n            newPosition.x -=  cos(angle) * d;\n            newPosition.z  = (radius + sin(degress) * radius) ;\n        } else {\n            float len = l + (l - halfCircle);\n            newPosition.y -= sin(angle) * len;\n            newPosition.x -= cos(angle) * len;\n            newPosition.z  = radius * 2.0;\n        }\n        verCoord = newPosition;\n        gl_Position = pMatrix * mvMatrix * vec4(newPosition, 1.0);\n    } else {\n        verCoord = vertexPosition;\n        gl_Position = pMatrix * mvMatrix * vec4(vertexPosition, 1.0);\n    }\n    \n}\n",t.fregmentShader="\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D texture;\nuniform vec2 screenSize; \nuniform float radius; \n\nvarying vec2 texCoord;\nvarying vec3 verCoord;\n\nconst float whiteWeight = 0.85;\nconst float texWeight = 0.10;\n\nvoid main(void) {\n    vec4 texColor = texture2D(texture, texCoord);\n    float diameter = radius*2.0;\n    if (verCoord.z > 0.0) {\n        if (verCoord.z > radius) {\n                texColor *= texWeight;\n                vec4 newColor = vec4(whiteWeight + texColor.r , whiteWeight  + texColor.g, whiteWeight*0.98 + texColor.b, 1.0); \n            if (verCoord.z < diameter) {\n                //模拟卷起片段的背面阴影, 卷起得越高,阴影越小\n                 newColor.rgb *= (1.0 - 0.15 * ((diameter-verCoord.z) / radius));\n                 gl_FragColor = vec4(newColor.rgb, 1.0);\n            } else {\n                gl_FragColor = newColor; \n            } \n        } else {\n            //高效模拟卷起片段的内面阴影, 卷起得越高,阴影越大\n            texColor.rgb *= (1.0 - 0.2 * (verCoord.z / radius));\n            gl_FragColor = vec4(texColor.rgb, 1.0);\n        }        \n    } else {\n         gl_FragColor = texColor;\n    }\n}\n"}])});