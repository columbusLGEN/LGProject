//
//  UserLeaseDetailVC.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 2017/10/27.
//  Copyright © 2017年 retech. All rights reserved.
//

#import "UserLeaseDetailVC.h"

@interface UserLeaseDetailVC ()
<UITableViewDelegate, UITableViewDataSource>

@property (strong, nonatomic) UITableView *tableView;
@property (strong, nonatomic) NSMutableArray *arrLeases;
@property (assign, nonatomic) NSInteger currendPage;

@end

@implementation UserLeaseDetailVC

- (void)viewDidLoad {
    [super viewDidLoad];
    [self configLeaseDetailView];
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

#pragma mark - 配置界面

- (void)updateSystemLanguage
{
//    if ([UserRequest sharedInstance].) {
//        <#statements#>
//    }
    self.title = [UserRequest sharedInstance].language == ENUM_LanguageTypeChinese ? _serial.serialName : _serial.serialName;
}

- (void)configLeaseDetailView
{
    
}

- (void)configMJRefresh
{
    _tableView.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^{
        [self getFirstPageLeases];
    }];
    _tableView.mj_footer = [MJRefreshBackNormalFooter footerWithRefreshingBlock:^{
        [self getLeasesWithPage:_currendPage];
    }];
}

#pragma mark - 获取数据

- (void)getFirstPageLeases
{
    _currendPage = 0;
    [[BookRequest sharedInstance] getBooksWithPage:_currendPage length:cListNumber_10 series:_serial.serialId Completion:^(id object, ErrorModel *error) {
        if (error) {
            [self presentFailureTips:error.message];
        }
        else {
            _arrLeases = [BookModel mj_objectArrayWithKeyValuesArray:object];
            if (_arrLeases.count > 0) {
                _currendPage += 1;
                [_tableView reloadData];
            }
        }
    }];
}

- (void)getLeasesWithPage:(NSInteger)page
{
    [[BookRequest sharedInstance] getBooksWithPage:page length:cListNumber_10 series:_serial.serialId Completion:^(id object, ErrorModel *error) {
        if (error) {
            [self presentFailureTips:error.message];
        }
        else {
            NSArray *array = [BookModel mj_objectArrayWithKeyValuesArray:object];
            if (array.count > 0) {
                _currendPage += 1;
                [_arrLeases addObjectsFromArray:array];
                [_tableView reloadData];
            }
        }
    }];
}

#pragma mark -

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return _arrLeases.count;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    UITableViewCell *cell;
    cell.data = _arrLeases[indexPath.row];
    return cell;
}

#pragma mark -

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    
}

@end
