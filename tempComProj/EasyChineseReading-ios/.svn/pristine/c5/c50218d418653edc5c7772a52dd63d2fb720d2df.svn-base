//
//  OrderRequest.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 17/9/4.
//  Copyright © 2017年 lee. All rights reserved.
//

#import "OrderRequest.h"

@interface OrderRequest ()

/* 订单数组 */
@property (strong, nonatomic) NSArray *arrOrders;

@end

@implementation OrderRequest

CM_SINGLETON_IMPLEMENTION(OrderRequest)


#pragma mark - 获取订单列表

/**
 获取订单列表
 
 @param page        页数
 @param orderStatus 订单状态(0 未完成 1 待评价 2 完成)
 @param orderType   订单类型(0 购买 1 租赁)
 @param length      每一页数据量
 @param completion  回调
 */
- (void)getOrderListWithPage:(NSInteger)page
                 orderStatus:(ENUM_ZOrderState)orderStatus
                   orderType:(NSString *)orderType
                      length:(NSString *)length
                  completion:(CompleteBlock)completion;
{
    NSDictionary *dic = @{@"params":
                              @{@"length"       : length,
                                @"userId"       : [NSString stringWithFormat:@"%ld", self.user.userId],
                                @"orderStatus"  : [NSString stringWithFormat:@"%ld", (long)orderStatus],
                                @"orderType"    : orderType,
                                @"page"         : [NSString stringWithFormat:@"%ld", (long)page]},
                          @"md5": @"654c01acaf40e0ce6d841a552fd3b96c"};
    
    [ZNetworkRequest requestWithHttpMethod:ENUM_ZHttpRequestMethodPost
                                    strUrl:@"order/queryOrders"
                                parameters:dic
                             completeBlock:^(id responseObject, ErrorModel *error) {
                                 if ( error )
                                 {
                                     completion(nil,error);
                                 }
                                 else
                                 {
                                     NSArray *list = [NSArray arrayWithArray:responseObject];
                                     
                                     _arrOrders = [NSMutableArray arrayWithArray:list];
                                     completion(_arrOrders, nil);
                                 }
                             }];
}

#pragma mark - 创建订单

/**
 创建订单
 
 @param type       类型 0.购买 1.租赁
 @param totalmoney 总价
 @param book       图书列表
 @param score      消费的积分
 @param serialId   系列 id
 @param readDay    租赁天数
 @param completion 回调
 */
- (void)createOrderWithType:(NSString *)type
                 totalmoney:(NSString *)totalmoney
                      books:(NSString *)book
                      score:(NSString *)score
                   serialId:(NSString *)serialId
                    readDay:(NSString *)readDay
                 completion:(CompleteBlock)completion
{
    NSDictionary *dic = @{@"params":@{@"userId"     : [NSString stringWithFormat:@"%ld", self.user.userId],
                                      @"type"       : type,
                                      @"totalmoney" : totalmoney,
                                      @"book"       : book,
                                      @"score"      : score,
                                      @"serialId"   : serialId,
                                      @"readDay"    : readDay,
                                      },
                          @"md5": @"654c01acaf40e0ce6d841a552fd3b96c"};
    
    [ZNetworkRequest requestWithHttpMethod:ENUM_ZHttpRequestMethodPost
                                    strUrl:@"order/addOrders"
                                parameters:dic
                             completeBlock:^(id responseObject, ErrorModel *error) {
                                 if ( error )
                                 {
                                     completion(nil,error);
                                 }
                                 else
                                 {
                                     completion(responseObject, nil);
                                 }
                             }];
}

#pragma mark - 用户订单支付结果

/**
 订单状态
 
 @param orderId    订单 id
 @param type       类型
 @param completion 回调
 */
- (void)postOrderResultWithOrderId:(NSString *)orderId
                              type:(NSString *)type
                        completion:(CompleteBlock)completion
{
    NSDictionary *dic = @{@"params":@{@"userId"     : [NSString stringWithFormat:@"%ld", self.user.userId],
                                      @"type"       : type,
                                      @"orderId"    : orderId,
                                      },
                          @"md5": @"654c01acaf40e0ce6d841a552fd3b96c"};
    
    [ZNetworkRequest requestWithHttpMethod:ENUM_ZHttpRequestMethodPost
                                    strUrl:@"read/orderPayStatus"
                                parameters:dic
                             completeBlock:^(id responseObject, ErrorModel *error) {
                                 if ( error )
                                 {
                                     completion(nil,error);
                                 }
                                 else
                                 {
                                     completion(responseObject, nil);
                                 }
                             }];
}

#pragma mark - 查看用户对订单的评分

/**
 查看用户对订单的评分
 
 @param orderId     订单id
 @param completion  回调
 */
- (void)getOrderScoreWithOrderId:(NSString *)orderId
                      completion:(CompleteBlock)completion
{
    NSDictionary *dic = @{@"params": @{@"orderId": orderId},
                          @"md5"   : @"654c01acaf40e0ce6d841a552fd3b96c"};
    [ZNetworkRequest requestWithHttpMethod:ENUM_ZHttpRequestMethodPost
                                    strUrl:@"score/orderScore"
                                parameters:dic
                             completeBlock:^(id responseObject, ErrorModel *error) {
                                 if (error) {
                                     completion(nil, error);
                                 }
                                 else {
                                     
                                     completion(responseObject, nil);
                                 }
                             }];
}

#pragma mark - 添加评分

/**
 添加评分
 
 @param orderId       订单id
 @param scores        分数数组（{{"userId":"1","orderDetailId ":"2","bookId":"4","score":"2"}）
 @param commentFinish 评论完成
 @param completion    回调
 */
- (void)addOrderScoreWithOrderId:(NSString *)orderId
                          scores:(NSArray *)scores
                   commentFinish:(NSString *)commentFinish
                      completion:(CompleteBlock)completion
{
    
    NSDictionary *dic = @{@"params": @{@"userId": [NSString stringWithFormat:@"%ld", self.user.userId],
                                       @"commentFinish": commentFinish,
                                       @"scores": [scores mj_JSONString],
                                       },
                          @"md5"   : @"654c01acaf40e0ce6d841a552fd3b96c"};
    [ZNetworkRequest requestWithHttpMethod:ENUM_ZHttpRequestMethodPost
                                    strUrl:@"score/addScore"
                                parameters:dic
                             completeBlock:^(id responseObject, ErrorModel *error) {
                                 if (error) {
                                     completion(nil, error);
                                 }
                                 else {
                                     completion(responseObject, nil);
                                 }
                             }];
}

#pragma mark - 查看书籍全部评分

/**
 查看书籍全部评分
 
 @param bookId      书籍id
 @param page        页数
 @param length      每页数据量
 @param completion  回调
 */
- (void)getOrderAllScoresWithBookId:(NSString *)bookId
                               page:(NSString *)page
                             length:(NSString *)length
                         completion:(CompleteBlock)completion
{
    NSDictionary *dic = @{@"params": @{@"bookId": bookId,
                                       @"page"  : page,
                                       @"length": length,
                                       },
                          @"md5"   : @"654c01acaf40e0ce6d841a552fd3b96c"};
    [ZNetworkRequest requestWithHttpMethod:ENUM_ZHttpRequestMethodPost
                                    strUrl:@"score/selectScore"
                                parameters:dic
                             completeBlock:^(id responseObject, ErrorModel *error) {
                                 if (error) {
                                     completion(nil, error);
                                 }
                                 else {
                                     
                                     completion(responseObject, nil);
                                 }
                             }];
}

@end
