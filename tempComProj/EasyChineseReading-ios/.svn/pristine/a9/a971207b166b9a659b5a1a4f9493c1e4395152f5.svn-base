//
//  ECRHypermediaManager.m
//  EasyChineseReading-ios
//
//  Created by Peanut Lee on 2017/11/13.
//  Copyright © 2017年 retech. All rights reserved.
//

#import "ECRHypermediaManager.h"
#import "DBPlayer.h"

@interface ECRHypermediaManager ()<DBPlayerDelegate>


@end

@implementation ECRHypermediaManager

+ (void)openHypermidiaWithURL:(NSString *)hyperURL vc:(UIViewController *)vc{
    [[self sharedInstance] openHypermidiaWithURL:hyperURL vc:vc];
}

- (void)openHypermidiaWithURL:(NSString *)hyperURL vc:(UIViewController *)vc{
    [vc presentViewController:self.dbPlayer animated:YES completion:^{
        [self.dbPlayer openABook:hyperURL contentUrl:@""];
    }];
}

#pragma mark - DBPlayerDelegate
- (void)dbPlayerDidClosed{
    [self.dbPlayer dismissViewControllerAnimated:YES completion:^{
        // 显示状态栏
        self.dbPlayer = nil;// 一定要释放前一个 player，否则会造成屏幕错位
    }];
}

+ (instancetype)sharedInstance{
    static id instance;
    static dispatch_once_t once;
    dispatch_once(&once, ^{
        instance = [self new];
    });
    return instance;
}

- (DBPlayer *)dbPlayer{
    if (_dbPlayer == nil) {
        _dbPlayer = [[DBPlayer alloc]init];
        _dbPlayer.delegate = self;
        _dbPlayer.modalTransitionStyle = UIModalTransitionStyleFlipHorizontal;
    }
    return _dbPlayer;
}
@end
