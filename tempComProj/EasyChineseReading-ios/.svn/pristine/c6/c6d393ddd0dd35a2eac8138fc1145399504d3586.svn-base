//
//  UOrderFooterView.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 17/9/4.
//  Copyright © 2017年 lee. All rights reserved.
//

#import "UserOrderFooterView.h"

@interface UserOrderFooterView ()
@property (weak, nonatomic) IBOutlet UIButton *btnRight;
@property (weak, nonatomic) IBOutlet UIButton *btnLeft;
@property (weak, nonatomic) IBOutlet UILabel *lblMoney;
@property (weak, nonatomic) IBOutlet UIView *viewBotLine;
@property (weak, nonatomic) IBOutlet UIView *viewTopLine;

@property (strong, nonatomic) OrderModel *order;

@end

@implementation UserOrderFooterView

- (void)drawRect:(CGRect)rect
{
    [super drawRect:rect];
}

- (void)awakeFromNib
{
    [super awakeFromNib];
    [self configDefaultOrderFooterView];
}

- (void)configDefaultOrderFooterView
{
    _btnRight.layer.masksToBounds = YES;
    _btnRight.layer.cornerRadius = _btnRight.height/2;
    
    _btnRight.layer.borderWidth = 1.f;
    _btnRight.layer.borderColor = [UIColor cm_mainColor].CGColor;
    _btnRight.backgroundColor = [UIColor whiteColor];
    [_btnRight setTitleColor:[UIColor cm_mainColor] forState:UIControlStateNormal];
    [_btnRight setTitle:LOCALIZATION(@"评价") forState:UIControlStateNormal];
    
    _btnLeft.layer.masksToBounds = YES;
    _btnLeft.layer.cornerRadius = _btnLeft.height/2;
    
    _btnLeft.layer.borderWidth = 1.f;
    _btnLeft.layer.borderColor = [UIColor cm_mainColor].CGColor;
    _btnLeft.backgroundColor = [UIColor whiteColor];
    [_btnLeft setTitleColor:[UIColor cm_mainColor] forState:UIControlStateNormal];
    [_btnLeft setTitle:LOCALIZATION(@"取消订单") forState:UIControlStateNormal];
    
    _viewTopLine.backgroundColor = [UIColor cm_lineColor_D9D7D7_1];
    _viewBotLine.backgroundColor = [UIColor cm_lineColor_D9D7D7_1];
    
    _lblMoney.textColor = [UIColor cm_orangeColor_FF5910_1];
    _lblMoney.font = [UIFont systemFontOfSize:cFontSize_12];
}

#pragma mark -
#pragma mark 数据更新


- (void)dataDidChange
{
    _order = self.data;
    NSString *string = [NSString stringWithFormat:@"%@: %@%.2f", LOCALIZATION(@"合计"), LOCALIZATION(@"¥"), _order.price];
    NSMutableAttributedString *money = [[NSMutableAttributedString alloc] initWithString:string];
    //获取要调整颜色的文字位置,调整颜色
    NSRange range = [[money string] rangeOfString:@" "];
    NSRange upRang = NSMakeRange(range.location, string.length - range.location - range.length + 1);
    [money addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:20.f] range:upRang];
    _lblMoney.attributedText = money;

//    if (_isDetailFooter) {
        _viewTopLine.hidden = YES;
//    }
    _btnLeft.hidden = _order.orderStatus != ENUM_ZOrderStateObligation;
    _btnRight.backgroundColor = _order.orderStatus == ENUM_ZOrderStateObligation ? [UIColor cm_mainColor] : [UIColor whiteColor];
    [_btnRight setTitleColor:_order.orderStatus == ENUM_ZOrderStateObligation ? [UIColor whiteColor] : [UIColor cm_mainColor] forState:UIControlStateNormal];
    if (_order.orderStatus == ENUM_ZOrderStateObligation) {
        [_btnRight setTitle:LOCALIZATION(@"立即付款") forState:UIControlStateNormal];
    }
    else if (_order.orderStatus == ENUM_ZOrderStateScore) {
        [_btnRight setTitle:LOCALIZATION(@"评价") forState:UIControlStateNormal];
    }
    else if (_order.orderStatus == ENUM_ZOrderStateDone) {
        [_btnRight setTitle:LOCALIZATION(@"删除订单") forState:UIControlStateNormal];
    }
    else {
        
    }
}

#pragma mark - action

- (IBAction)click_btnRight:(id)sender {
    if (_order.orderStatus == ENUM_ZOrderStateObligation) {
        [self.delegate payOrderWithOrder:_order];
    }
    else if (_order.orderStatus == ENUM_ZOrderStateScore) {
        [self.delegate evaluateWithOrder:_order];
    }
    else if (_order.orderStatus == ENUM_ZOrderStateDone) {
        [self.delegate deleteOrderWithOrder:_order];
    }
    else {
        // nil
    }
}
- (IBAction)click_btnLeft:(id)sender {
    if (_order.orderStatus == ENUM_ZOrderStateObligation) {
        [self.delegate cancelOrderWithOrder:_order];
    }
}

@end
