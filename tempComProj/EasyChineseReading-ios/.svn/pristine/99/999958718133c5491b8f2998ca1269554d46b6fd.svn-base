//
//  UserFriendNewManagerVC.m
//  EasyChineseReading-ios
//
//  Created by 赵春阳 on 2017/12/6.
//  Copyright © 2017年 retech. All rights reserved.
//

#import "UserFriendNewManagerVC.h"

#import "UFriendDynamicViewController.h"
#import "UFriendListViewController.h"

@interface UserFriendNewManagerVC ()

@property (strong, nonatomic) UFriendDynamicViewController *dynamicVC; // 动态
@property (strong, nonatomic) UFriendListViewController    *friendsVC; // 好友

@property (strong, nonatomic) UIView *headerView;
@property (strong, nonatomic) UIView *viewSlide;
@property (strong, nonatomic) UILabel *lblLeft;
@property (strong, nonatomic) UILabel *lblRight;

@property (assign, nonatomic) BOOL isFriendView;

@end

@implementation UserFriendNewManagerVC

- (void)viewDidLoad {
    [super viewDidLoad];
    [self configManagerView];
}

- (void)viewWillAppear:(BOOL)animated
{
    [super viewWillAppear:animated];
    [self.navigationController setNavigationBarHidden:YES animated:YES];
}

- (void)viewWillDisappear:(BOOL)animated
{
    [super viewWillDisappear:animated];
    if (_isFriendView) {
        _dynamicVC.view.hidden = YES;
    }
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (void)configManagerView
{
    UIImageView *imageV = [[UIImageView alloc] initWithFrame:CGRectMake(0, -20, Screen_Width, Screen_Height + 20)];
    imageV.image = [UIImage imageNamed:@"img_background_friend"];
    [self.view addSubview:imageV];
    
    [self config_headerView];
    
    [self configFriendsView];
    [self configDynamicView];
}

- (void)config_headerView
{
    _headerView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, Screen_Width, cHeaderHeight_64 + cHeaderHeight_44)];
    _headerView.backgroundColor = [UIColor clearColor];
    [self.view addSubview:_headerView];
    
    UIImageView *imgMask = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, Screen_Width, cHeaderHeight_44)];
    imgMask.image = [UIImage imageNamed:@"icon_home_nav_bg"];
    [_headerView addSubview:imgMask];
    
    UIImageView *imgBack = [[UIImageView alloc] initWithFrame:CGRectMake(0, 20, cHeaderHeight_44, cHeaderHeight_44)];
    imgBack.image = [UIImage imageNamed:@"icon_arrow_left_white"];
    imgBack.contentMode = UIViewContentModeCenter;
    imgBack.userInteractionEnabled = YES;
    [_headerView addSubview:imgBack];
    
    UILabel *lblTitle = [[UILabel alloc] init];
    lblTitle.frame = CGRectMake(Screen_Width/2 - [NSString stringWidthWithText:LOCALIZATION(@"我的好友") fontSize:cFontSize_16]/2, 20, [NSString stringWidthWithText:LOCALIZATION(@"我的好友") fontSize:cFontSize_18], cHeaderHeight_44);
    lblTitle.text = LOCALIZATION(@"我的好友");
    lblTitle.backgroundColor = [UIColor clearColor];
    lblTitle.textColor = [UIColor whiteColor];
    lblTitle.textAlignment = NSTextAlignmentCenter;
    lblTitle.font = [UIFont boldSystemFontOfSize:cFontSize_18];
    [_headerView addSubview:lblTitle];
    
    UIView *viewTopLine = [[UIView alloc] initWithFrame:CGRectMake(0, cHeaderHeight_64, Screen_Width, .5f)];
    viewTopLine.backgroundColor = [UIColor whiteColor];
    [_headerView addSubview:viewTopLine];
    
    _lblLeft = [[UILabel alloc] initWithFrame:CGRectMake(0, cHeaderHeight_64, Screen_Width/2, cHeaderHeight_44)];
    _lblLeft.textColor = [UIColor whiteColor];
    _lblLeft.backgroundColor = [UIColor clearColor];
    _lblLeft.text = LOCALIZATION(@"好友动态");
    _lblLeft.textAlignment = NSTextAlignmentCenter;
    _lblLeft.font = [UIFont systemFontOfSize:cFontSize_16];
    _lblLeft.userInteractionEnabled = YES;
    [_headerView addSubview:_lblLeft];
    
    _lblRight = [[UILabel alloc] initWithFrame:CGRectMake(Screen_Width/2 + 1, cHeaderHeight_64, Screen_Width/2, cHeaderHeight_44)];
    _lblRight.textColor = [UIColor whiteColor];
    _lblRight.backgroundColor = [UIColor clearColor];
    _lblRight.text = LOCALIZATION(@"我的好友");
    _lblRight.textAlignment = NSTextAlignmentCenter;
    _lblRight.font = [UIFont systemFontOfSize:cFontSize_16];
    _lblRight.userInteractionEnabled = YES;
    [_headerView addSubview:_lblRight];
    
    UIView *viewBotLine = [[UIView alloc] initWithFrame:CGRectMake(0, cHeaderHeight_64 + cHeaderHeight_44 - 1, Screen_Width, .5f)];
    viewBotLine.backgroundColor = [UIColor whiteColor];
    [_headerView addSubview:viewBotLine];
    
    UIView *viewVerLine = [[UIView alloc] initWithFrame:CGRectMake(Screen_Width/2, cHeaderHeight_64 + 10, 1, cHeaderHeight_44 - 10*2)];
    viewVerLine.backgroundColor = [UIColor whiteColor];
    [_headerView addSubview:viewVerLine];
    
    _viewSlide = [[UIView alloc] initWithFrame:CGRectMake(_lblLeft.width/2-[NSString stringWidthWithText:_lblLeft.text fontSize:cFontSize_16]/2, cHeaderHeight_44 + cHeaderHeight_64 - 3, [NSString stringWidthWithText:_lblLeft.text fontSize:cFontSize_16], 3)];
    _viewSlide.backgroundColor = [UIColor whiteColor];
    [_headerView addSubview:_viewSlide];
    
    UITapGestureRecognizer *tapB = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapBack)];
    UITapGestureRecognizer *tapL = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapDynamic)];
    UITapGestureRecognizer *tapR = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapFriends)];
    [imgBack   addGestureRecognizer:tapB];
    [_lblLeft  addGestureRecognizer:tapL];
    [_lblRight addGestureRecognizer:tapR];
}

#pragma mark -

- (void)configFriendsView {
    _friendsVC = [UFriendListViewController new];
    _friendsVC.view.frame = CGRectMake(Screen_Width, cHeaderHeight_64 + cHeaderHeight_44, Screen_Width, Screen_Height - cHeaderHeight_44 - cHeaderHeight_64 + 20);
    
    [self addChildViewController:_friendsVC];
    [self.view addSubview:_friendsVC.view];
}

- (void)configDynamicView {
    _dynamicVC = [UFriendDynamicViewController new];
    _dynamicVC.view.frame = CGRectMake(0, cHeaderHeight_64 + cHeaderHeight_44, Screen_Width, Screen_Height - cHeaderHeight_44 - cHeaderHeight_64 + 20);
    
    [self addChildViewController:_dynamicVC];
    [self.view addSubview:_dynamicVC.view];
}

#pragma mark -

- (void)tapDynamic
{
    _isFriendView = NO;
    [UIView animateWithDuration:cAnimationTime animations:^{
        _viewSlide.frame = CGRectMake(_lblLeft.width/2-[NSString stringWidthWithText:_lblLeft.text fontSize:cFontSize_16]/2, cHeaderHeight_44 + cHeaderHeight_64 - 3, [NSString stringWidthWithText:_lblLeft.text fontSize:cFontSize_16], 3);
        _dynamicVC.view.frame = CGRectMake(0, cHeaderHeight_64 + cHeaderHeight_44, Screen_Width, Screen_Height - cHeaderHeight_44 - cHeaderHeight_64 + 20);
        _friendsVC.view.frame = CGRectMake(Screen_Width, cHeaderHeight_64 + cHeaderHeight_44, Screen_Width, Screen_Height - cHeaderHeight_44 - cHeaderHeight_64 + 20);
    }];
    [self.view bringSubviewToFront:_dynamicVC.view];
}

- (void)tapFriends
{
    _isFriendView = YES;
    [UIView animateWithDuration:cAnimationTime animations:^{
        _viewSlide.frame = CGRectMake(_lblLeft.width + _lblRight.width/2-[NSString stringWidthWithText:_lblRight.text fontSize:cFontSize_16]/2, cHeaderHeight_44 + cHeaderHeight_64 - 3, [NSString stringWidthWithText:_lblRight.text fontSize:cFontSize_16], 3);
        _dynamicVC.view.frame = CGRectMake(-Screen_Width, cHeaderHeight_64 + cHeaderHeight_44, Screen_Width, Screen_Height - cHeaderHeight_44 - cHeaderHeight_64 + 20);
        _friendsVC.view.frame = CGRectMake(0, cHeaderHeight_64 + cHeaderHeight_44, Screen_Width, Screen_Height - cHeaderHeight_44 - cHeaderHeight_64 + 20);
    }];
    [self.view bringSubviewToFront:_friendsVC.view];
}

- (void)tapBack
{
    [self.navigationController popViewControllerAnimated:YES];
}

@end
